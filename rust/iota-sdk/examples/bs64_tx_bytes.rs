//! cargo run --example bs64_tx_bytes

use base64::Engine;
use eyre::Result;
// use iota_sdk::graphql_client::Client;
use iota_sdk::types::{SenderSignedTransaction, Transaction};

#[tokio::main]
async fn main() -> Result<()> {
    let tx_bytes_base64 = "AAACACAAAKSYS9SV1DRvogjd/09dXlrUjCHexjHd68mYCfFpAAAIAPIFKgEAAAACAgABAQEAAQECAAABAABhGDDTZBpo+UppDcwl0fSw2slIMlrBj23TJWQ3FzXzLAILAnDunSfaDbCWUeX3M436MsfuZEHM76H24wVzW8/Hq3M6MhwAAAAAIKlI7704HwxEKcAJUDavYxFuJgvpsFwQktqa3/trEI4n0EB3/jtvrROz1O0NU1t8qSr8rI8PKg4JJfufTwswxplyOjIcAAAAACBwo4RInFHkslDFUznEltYw/OPcH4EFo0/At7kMLZpocGEYMNNkGmj5SmkNzCXR9LDayUgyWsGPbdMlZDcXNfMs6AMAAAAAAACgLS0AAAAAAAA=";
    let transaction = Transaction::from_base64(tx_bytes_base64)?;
    println!("Transaction decoded:\n{:#?}", transaction);

    // let client = Client::new_devnet();
    // let res = client.dry_run_tx(&transaction, false).await?;

    // if let Some(err) = res.error {
    //     eyre::bail!("Dry run failed: {err}");
    // }

    // println!("Dry run was successful!");
    // println!("Dry run result: {res:#?}");

    let signed_tx_bytes_base64 = "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";
    let signed_tx_bytes = Engine::decode(
        &base64::engine::general_purpose::STANDARD,
        signed_tx_bytes_base64,
    )?;
    let signed_transaction = bcs::from_bytes::<SenderSignedTransaction>(&signed_tx_bytes)?;
    println!("Signed Transaction decoded:\n{:#?}", signed_transaction.0);

    let tx_bytes = bcs::to_bytes(&signed_transaction.0.transaction)?;
    let tx_bytes_encoded = Engine::encode(&base64::engine::general_purpose::STANDARD, &tx_bytes);
    println!("Tx from signed transaction (base64):\n{}", tx_bytes_encoded);

    Ok(())
}
